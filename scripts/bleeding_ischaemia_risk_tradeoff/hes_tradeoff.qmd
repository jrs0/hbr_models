---
title: "Bleeding/Ischaemia Risk Trade-off Models Using Hospital Episode Statistics"
project:
  output-dir: _output
execute:
  echo: false
format:
  pdf
jupyter: python3
---

```{python}
import os

os.chdir("../prototypes")

import matplotlib.pyplot as plt

import save_datasets as ds
from stability import plot_instability
from calibration import (
    get_bootstrapped_calibration,
    plot_calibration_curves,
    plot_prediction_distribution,
)
from roc import get_bootstrapped_roc, get_bootstrapped_auc, plot_roc_curves

```

# Introduction

# Literature

# Dataset Definitions

```{python}

```

# Bleeding Models

```{python}
d = ds.load_fit_info("simple_logistic_regression")

# Plot the basic instability curve
fig, ax = plt.subplots()
plot_instability(ax, d["probs"])
plt.show()

# Get the bootstrapped calibration curves
calibration_curves = get_bootstrapped_calibration(d["probs"], d["y_test"], n_bins=10)

# Plot the calibration-stability plots
fig, ax = plt.subplots(2, 1)
plot_calibration_curves(ax[0], calibration_curves)
# Plot the distribution of predicted probabilities, also
# showing distribution stability (over the bootstrapped models)
# as error bars on each bin height
plot_prediction_distribution(ax[1], d["probs"], n_bins=10)
plt.show()

# Get the bootstrapped ROC curves
roc_curves = get_bootstrapped_roc(d["probs"], d["y_test"])
roc_auc = get_bootstrapped_auc(d["probs"], d["y_test"])

# Plot the ROC-stability curves
fig, ax = plt.subplots()
plot_roc_curves(ax, roc_curves, roc_auc)
plt.show()

```

# Ischaemia Models

# Risk Trade-off Model

# Discussion

# Conclusion