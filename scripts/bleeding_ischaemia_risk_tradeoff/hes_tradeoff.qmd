---
title: "Bleeding/Ischaemia Risk Trade-off Models"
project:
  output-dir: _output
execute:
  echo: false
  warning: false
format:
  pdf
jupyter: python3
fig-format: png
---

```{python}
# Some tips on using this file
# - print() does not work for rendering markdown in code block. It will mess up
#   the order of figures and text (e.g. headings)
# - To make heading, using display(Markdown("Heading Name\\")). The two trailing
#   slashes make a newline, which is important. 

import os

os.chdir("../prototypes")

import pandas as pd
import matplotlib.pyplot as plt
from IPython.display import display, Markdown

import save_datasets as ds
from stability import plot_instability
from calibration import (
    get_bootstrapped_calibration,
    plot_calibration_curves,
    plot_prediction_distribution,
)
from plot_model import plot_model_validation_2page
from roc import get_bootstrapped_roc, get_bootstrapped_auc, plot_roc_curves

dataset_names = {
    "manual_codes": "HES (manual code groups)",
    "all_codes": "HES (all codes)",
    "manual_codes_swd": "HES (manual code groups) + SWD",
}
model_names = {
    "simple_logistic_regression": "Logistic Regression",
    "truncsvd_logistic_regression": "Truncated SVD + Logistic Regress",
}
outcome_names = {
    "bleeding_al_ani_outcome": "Bleeding",
    "hussain_ami_stroke_outcome": "AMI or Stroke",
}
```

# Introduction

The table below shows a summary of the performance of the models for bleeding and ischaemia across all models and datasets

```{python}
#| label: tbl-ohe_example
#| tbl-cap: 'One-hot vectorization example'
#| tbl-column: body
#| output: asis

print(
    pd.DataFrame(
        data = {
            'Sentence': ['I like to eat apples', 'I like to eat bananas'],
            'Tokens' : [['I', 'like', 'to', 'eat', 'apples'], ['I', 'like', 'to', 'eat', 'bananas']],
            'Vector' : [[1, 1, 1, 1, 1, 0], [1, 1, 1, 1, 0, 1]],
        }
    ).to_latex(
        index = False,
        position = 'h',
    )
)
```


# Literature

# Models

```{python}
# | output: asis

# Page break before the first model section
#display(Markdown("{{< pagebreak >}}"))

for dataset, dataset_title in dataset_names.items():
  
  display(Markdown(f"## {dataset_title}\\"))

  # This is the place to put exactly one page summarising
  # the dataset characteristics
  display(Markdown("Dataset description here.\\"))

  num_models = len(model_names)
  for m, (model, model_title) in enumerate(model_names.items()):
    display(Markdown(f"## {model_title}\\"))
    for outcome, outcome_title in outcome_names.items():
      display(Markdown(f"### {outcome_title}\\"))
      try:
        plot_model_validation_2page(dataset, model, outcome)
      except:
        display(Markdown("Currently missing.\\"))
```

## Risk Trade-off Model

# Discussion

# Conclusion